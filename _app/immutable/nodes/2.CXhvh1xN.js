var ft=Object.defineProperty;var dt=(t,e,r)=>e in t?ft(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var Ce=(t,e,r)=>dt(t,typeof e!="symbol"?e+"":e,r);import{a as T,t as I,d as vt,c as ye}from"../chunks/disclose-version.CAdquCCa.js";import{i as Ae}from"../chunks/legacy.BssRHClI.js";import{m as X,M as Ie,a5 as gt,a4 as bt,J as wt,i as ht,I as mt,al as Qe,K as yt,L as Pe,N as ke,o as fe,ah as pt,as as pe,O as $e,j as et,P as St,F as Se,at as At,au as Et,ak as xt,av as Tt,k as Ut,a9 as tt,a2 as It,A as Fe,aw as kt,ax as Nt,ay as Dt,af as Mt,az as zt,aA as Bt,H as Ot,aB as Rt,E as Lt,aC as Ct,aD as Pt,an as Ft,b as rt,aE as qt,ab as Wt,n as de,aF as Gt,a8 as qe,V as We,aG as jt,ao as Vt,p as Ee,v as U,g as i,w as A,t as Y,x as C,s as xe,C as S,aH as O,q as ce}from"../chunks/runtime.aM-MgH7P.js";import{a as Yt,b as Ht,l as Kt,s as ie,e as j}from"../chunks/render.BQguKTEm.js";import{p as q,i as W}from"../chunks/props.D3gNug4Y.js";import{a as Zt,o as nt}from"../chunks/index-client.DdzatICg.js";function ue(t,e){return e}function Jt(t,e,r,n){for(var s=[],a=e.length,o=0;o<a;o++)Et(e[o].e,s,!0);var g=a>0&&s.length===0&&r!==null;if(g){var d=r.parentNode;xt(d),d.append(r),n.clear(),ae(t,e[0].prev,e[a-1].next)}Tt(s,()=>{for(var m=0;m<a;m++){var w=e[m];g||(n.delete(w.k),ae(t,w.prev,w.next)),Ut(w.e,!g)}})}function _e(t,e,r,n,s,a=null){var o=t,g={flags:e,items:new Map,first:null};{var d=t;o=X?Ie(gt(d)):d.appendChild(bt())}X&&wt();var m=null,w=!1;ht(()=>{var _=r(),b=mt(_)?_:_==null?[]:Qe(_),v=b.length;if(w&&v===0)return;w=v===0;let u=!1;if(X){var x=o.data===yt;x!==(v===0)&&(o=Pe(),Ie(o),ke(!1),u=!0)}if(X){for(var k=null,D,y=0;y<v;y++){if(fe.nodeType===8&&fe.data===pt){o=fe,u=!0,ke(!1);break}var M=b[y],F=n(M,y);D=st(fe,g,k,null,M,F,y,s,e),g.items.set(F,D),k=D}v>0&&Ie(Pe())}if(!X){var P=tt;Xt(b,g,o,s,e,(P.f&pe)!==0,n)}a!==null&&(v===0?m?$e(m):m=et(()=>a(o)):m!==null&&St(m,()=>{m=null})),u&&ke(!0),r()}),X&&(o=fe)}function Xt(t,e,r,n,s,a,o,g){var d=t.length,m=e.items,w=e.first,_=w,b,v=null,u=[],x=[],k,D,y,M;for(M=0;M<d;M+=1){if(k=t[M],D=o(k,M),y=m.get(D),y===void 0){var F=_?_.e.nodes_start:r;v=st(F,e,v,v===null?e.first:v.next,k,D,M,n,s),m.set(D,v),u=[],x=[],_=v.next;continue}if(Qt(y,k,M),y.e.f&pe&&$e(y.e),y!==_){if(b!==void 0&&b.has(y)){if(u.length<x.length){var P=x[0],R;v=P.prev;var G=u[0],Q=u[u.length-1];for(R=0;R<u.length;R+=1)Ge(u[R],P,r);for(R=0;R<x.length;R+=1)b.delete(x[R]);ae(e,G.prev,Q.next),ae(e,v,G),ae(e,Q,P),_=P,v=Q,M-=1,u=[],x=[]}else b.delete(y),Ge(y,_,r),ae(e,y.prev,y.next),ae(e,y,v===null?e.first:v.next),ae(e,v,y),v=y;continue}for(u=[],x=[];_!==null&&_.k!==D;)(a||!(_.e.f&pe))&&(b??(b=new Set)).add(_),x.push(_),_=_.next;if(_===null)continue;y=_}u.push(y),v=y,_=y.next}if(_!==null||b!==void 0){for(var h=b===void 0?[]:Qe(b);_!==null;)(a||!(_.e.f&pe))&&h.push(_),_=_.next;var c=h.length;if(c>0){var f=d===0?r:null;Jt(e,h,f,m)}}Se.first=e.first&&e.first.e,Se.last=v&&v.e}function Qt(t,e,r,n){At(t.v,e),t.i=r}function st(t,e,r,n,s,a,o,g,d,m){var w=(d&Nt)!==0,_=(d&Dt)===0,b=w?_?It(s):Fe(s):s,v=d&kt?Fe(o):o,u={i:v,v:b,k:a,a:null,e:null,prev:r,next:n};try{return u.e=et(()=>g(t,b,v),X),u.e.prev=r&&r.e,u.e.next=n&&n.e,r===null?e.first=u:(r.next=u,r.e.next=u.e),n!==null&&(n.prev=u,n.e.prev=u.e),u}finally{}}function Ge(t,e,r){for(var n=t.next?t.next.e.nodes_start:r,s=e?e.e.nodes_start:r,a=t.e.nodes_start;a!==n;){var o=Mt(a);s.before(a),a=o}}function ae(t,e,r){e===null?t.first=r:(e.next=r,e.e.next=r&&r.e),r!==null&&(r.prev=e,r.e.prev=e&&e.e)}function at(t){if(X){var e=!1,r=()=>{if(!e){if(e=!0,t.hasAttribute("value")){var n=t.value;le(t,"value",null),t.value=n}if(t.hasAttribute("checked")){var s=t.checked;le(t,"checked",null),t.checked=s}}};t.__on_r=r,zt(r),Yt()}}function le(t,e,r,n){var s=t.__attributes??(t.__attributes={});X&&(s[e]=t.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&t.nodeName==="LINK")||s[e]!==(s[e]=r)&&(e==="style"&&"__styles"in t&&(t.__styles={}),e==="loading"&&(t[Bt]=r),r==null?t.removeAttribute(e):typeof r!="string"&&$t(t).includes(e)?t[e]=r:t.setAttribute(e,r))}var je=new Map;function $t(t){var e=je.get(t.nodeName);if(e)return e;je.set(t.nodeName,e=[]);for(var r,n=t,s=Element.prototype;s!==n;){r=Rt(n);for(var a in r)r[a].set&&e.push(a);n=Ot(n)}return e}function ze(t,e,r){var n=t.__className,s=er(e);X&&t.className===s?t.__className=s:(n!==s||X&&t.className!==s)&&(e==null&&!r?t.removeAttribute("class"):t.className=s,t.__className=s)}function er(t,e){return(t??"")+""}function tr(t,e,r){if(r){if(t.classList.contains(e))return;t.classList.add(e)}else{if(!t.classList.contains(e))return;t.classList.remove(e)}}const rr=()=>performance.now(),re={tick:t=>requestAnimationFrame(t),now:()=>rr(),tasks:new Set};function it(){const t=re.now();re.tasks.forEach(e=>{e.c(t)||(re.tasks.delete(e),e.f())}),re.tasks.size!==0&&re.tick(it)}function nr(t){let e;return re.tasks.size===0&&re.tick(it),{promise:new Promise(r=>{re.tasks.add(e={c:t,f:r})}),abort(){re.tasks.delete(e)}}}function Ve(t,e){t.dispatchEvent(new CustomEvent(e))}function sr(t){if(t==="float")return"cssFloat";if(t==="offset")return"cssOffset";if(t.startsWith("--"))return t;const e=t.split("-");return e.length===1?e[0]:e[0]+e.slice(1).map(r=>r[0].toUpperCase()+r.slice(1)).join("")}function Ye(t){const e={},r=t.split(";");for(const n of r){const[s,a]=n.split(":");if(!s||a===void 0)break;const o=sr(s.trim());e[o]=a.trim()}return e}const ar=t=>t;function Ne(t,e,r,n){var s=(t&Gt)!==0,a="in",o,g=e.inert,d,m;function w(){var x=tt,k=Se;qe(null),We(null);try{return o??(o=r()(e,(n==null?void 0:n())??{},{direction:a}))}finally{qe(x),We(k)}}var _={is_global:s,in(){e.inert=g,d==null||d.abort(),Ve(e,"introstart"),d=ot(e,w(),m,1,()=>{Ve(e,"introend"),d==null||d.abort(),d=o=void 0})},out(x){{x==null||x(),o=void 0;return}},stop:()=>{d==null||d.abort()}},b=Se;if((b.transitions??(b.transitions=[])).push(_),Ht){var v=s;if(!v){for(var u=b.parent;u&&u.f&Lt;)for(;(u=u.parent)&&!(u.f&Ct););v=!u||(u.f&Pt)!==0}v&&Ft(()=>{rt(()=>_.in())})}}function ot(t,e,r,n,s){if(qt(e)){var a,o=!1;return Wt(()=>{if(!o){var x=e({direction:"in"});a=ot(t,x,r,n,s)}}),{abort:()=>{o=!0,a==null||a.abort()},deactivate:()=>a.deactivate(),reset:()=>a.reset(),t:()=>a.t()}}if(!(e!=null&&e.duration))return s(),{abort:de,deactivate:de,reset:de,t:()=>n};const{delay:g=0,css:d,tick:m,easing:w=ar}=e;var _=[];if(m&&m(0,1),d){var b=Ye(d(0,1));_.push(b,b)}var v=()=>1-n,u=t.animate(_,{duration:g});return u.onfinish=()=>{var x=1-n,k=n-x,D=e.duration*Math.abs(k),y=[];if(D>0){if(d)for(var M=Math.ceil(D/16.666666666666668),F=0;F<=M;F+=1){var P=x+k*w(F/M),R=d(P,1-P);y.push(Ye(R))}v=()=>{var G=u.currentTime;return x+k*w(G/D)},m&&nr(()=>{if(u.playState!=="running")return!1;var G=v();return m(G,1-G),!0})}u=t.animate(y,{duration:D,fill:"forwards"}),u.onfinish=()=>{v=()=>n,m==null||m(n,1-n),s()}},{abort:()=>{u&&(u.cancel(),u.effect=null,u.onfinish=de)},deactivate:()=>{s=de},reset:()=>{},t:()=>v()}}function ct(t,e,r=e){var n=jt();Kt(t,"input",s=>{var a=s?t.defaultValue:t.value;if(a=De(t)?Me(a):a,r(a),n&&a!==(a=e())){var o=t.selectionStart,g=t.selectionEnd;t.value=a??"",g!==null&&(t.selectionStart=o,t.selectionEnd=Math.min(g,t.value.length))}}),(X&&t.defaultValue!==t.value||rt(e)==null&&t.value)&&r(De(t)?Me(t.value):t.value),Vt(()=>{var s=e();De(t)&&s===Me(t.value)||t.type==="date"&&!s&&!t.value||s!==t.value&&(t.value=s??"")})}function De(t){var e=t.type;return e==="number"||e==="range"}function Me(t){return t===""?null:+t}const ir=!0,on=Object.freeze(Object.defineProperty({__proto__:null,prerender:ir},Symbol.toStringTag,{value:"Module"}));class or{constructor(){Ce(this,"db",null)}async init(){return new Promise((e,r)=>{const n=indexedDB.open("UserData",1);n.onupgradeneeded=()=>{this.db=n.result,this.db.objectStoreNames.contains("userSessions")||this.db.createObjectStore("userSessions")},n.onsuccess=()=>{this.db=n.result,e()},n.onerror=()=>{console.error("Error opening IndexedDB:",n.error),r(n.error)}})}async saveSession(e,r){if(!this.db)throw new Error("Database is not initialized.");const n=this.db.transaction("userSessions","readwrite"),s=n.objectStore("userSessions");return new Promise((a,o)=>{s.put(r,e.toString()),n.oncomplete=()=>{console.log(`Session saved for user: ${e}`),a()},n.onerror=()=>{console.error("Error saving session:",n.error),o(n.error)}})}async getSession(e){if(!this.db)throw new Error("Database is not initialized.");const n=this.db.transaction("userSessions","readonly").objectStore("userSessions");return new Promise((s,a)=>{const o=n.get(e.toString());o.onsuccess=()=>{s(o.result||null)},o.onerror=()=>{console.error("Error loading session:",o.error),a(o.error)}})}async deleteSession(e){if(!this.db)throw new Error("Database is not initialized.");const r=this.db.transaction("userSessions","readwrite"),n=r.objectStore("userSessions");return new Promise((s,a)=>{n.delete(e.toString()),r.oncomplete=()=>{console.log(`Session deleted for user: ${e}`),s()},r.onerror=()=>{console.error("Error deleting session:",r.error),a(r.error)}})}async sessionExists(e){return await this.getSession(e)!==null}getDB(){if(!this.db)throw new Error("Database is not initialized");return this.db}}const ve=new or;typeof window<"u"&&(window.initDB=()=>ve.init(),window.saveUserSession=(t,e)=>{const r=e.buffer;return ve.saveSession(t,r)},window.getUserSession=t=>ve.getSession(t),window.deleteUserSession=t=>ve.deleteSession(t),window.checkSessionExists=t=>ve.sessionExists(t));let N;function ge(t){const e=N.__externref_table_alloc();return N.__wbindgen_export_2.set(e,t),e}function He(t,e){try{return t.apply(this,e)}catch(r){const n=ge(r);N.__wbindgen_exn_store(n)}}const lt=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&lt.decode();let be=null;function Be(){return(be===null||be.byteLength===0)&&(be=new Uint8Array(N.memory.buffer)),be}function Ke(t,e){return t=t>>>0,lt.decode(Be().subarray(t,t+e))}function me(t){return t==null}const Ze=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(t=>{N.__wbindgen_export_3.get(t.dtor)(t.a,t.b)});function cr(t,e,r,n){const s={a:t,b:e,cnt:1,dtor:r},a=(...o)=>{s.cnt++;const g=s.a;s.a=0;try{return n(g,s.b,...o)}finally{--s.cnt===0?(N.__wbindgen_export_3.get(s.dtor)(g,s.b),Ze.unregister(s)):s.a=g}};return a.original=s,Ze.register(a,s,s),a}function lr(t,e){return t=t>>>0,Be().subarray(t/1,t/1+e)}let ut=0;function ur(t,e){const r=e(t.length*1,1)>>>0;return Be().set(t,r/1),ut=t.length,r}function _r(t,e,r){N.closure20_externref_shim(t,e,r)}function fr(t,e,r,n){N.closure41_externref_shim(t,e,r,n)}const Je=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(t=>N.__wbg_sessionmanager_free(t>>>0,1));class dr{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Je.unregister(this),e}free(){const e=this.__destroy_into_raw();N.__wbg_sessionmanager_free(e,0)}constructor(){const e=N.sessionmanager_new();return this.__wbg_ptr=e>>>0,Je.register(this,this.__wbg_ptr,this),this}initialize(){return N.sessionmanager_initialize(this.__wbg_ptr)}save_session(e,r){const n=ur(r,N.__wbindgen_malloc),s=ut;return N.sessionmanager_save_session(this.__wbg_ptr,e,n,s)}get_session(e){return N.sessionmanager_get_session(this.__wbg_ptr,e)}delete_session(e){return N.sessionmanager_delete_session(this.__wbg_ptr,e)}session_exists(e){return N.sessionmanager_session_exists(this.__wbg_ptr,e)}}async function vr(t,e){if(typeof Response=="function"&&t instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(t,e)}catch(n){if(t.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const r=await t.arrayBuffer();return await WebAssembly.instantiate(r,e)}else{const r=await WebAssembly.instantiate(t,e);return r instanceof WebAssembly.Instance?{instance:r,module:t}:r}}function gr(){const t={};return t.wbg={},t.wbg.__wbg_buffer_61b7ce01341d7f88=function(e){return e.buffer},t.wbg.__wbg_call_500db948e69c7330=function(){return He(function(e,r,n){return e.call(r,n)},arguments)},t.wbg.__wbg_call_b0d8e36992d9900d=function(){return He(function(e,r){return e.call(r)},arguments)},t.wbg.__wbg_checkSessionExists_340e16b697e915bf=function(e){return checkSessionExists(BigInt.asUintN(64,e))},t.wbg.__wbg_deleteUserSession_36cd7b326cd4514a=function(e){return deleteUserSession(BigInt.asUintN(64,e))},t.wbg.__wbg_getUserSession_e0f134950e9904c6=function(e){return getUserSession(BigInt.asUintN(64,e))},t.wbg.__wbg_initDB_5ef5f7eaea3713b7=function(){return initDB()},t.wbg.__wbg_length_65d1cd11729ced11=function(e){return e.length},t.wbg.__wbg_new_3d446df9155128ef=function(e,r){try{var n={a:e,b:r},s=(o,g)=>{const d=n.a;n.a=0;try{return fr(d,n.b,o,g)}finally{n.a=d}};return new Promise(s)}finally{n.a=n.b=0}},t.wbg.__wbg_new_3ff5b33b1ce712df=function(e){return new Uint8Array(e)},t.wbg.__wbg_newnoargs_fd9e4bf8be2bc16d=function(e,r){return new Function(Ke(e,r))},t.wbg.__wbg_newwithbyteoffsetandlength_ba35896968751d91=function(e,r,n){return new Uint8Array(e,r>>>0,n>>>0)},t.wbg.__wbg_newwithlength_34ce8f1051e74449=function(e){return new Uint8Array(e>>>0)},t.wbg.__wbg_queueMicrotask_2181040e064c0dc8=function(e){queueMicrotask(e)},t.wbg.__wbg_queueMicrotask_ef9ac43769cbcc4f=function(e){return e.queueMicrotask},t.wbg.__wbg_resolve_0bf7c44d641804f9=function(e){return Promise.resolve(e)},t.wbg.__wbg_saveUserSession_0686280def1dddff=function(e,r){return saveUserSession(BigInt.asUintN(64,e),r)},t.wbg.__wbg_set_23d69db4e5c66a6e=function(e,r,n){e.set(r,n>>>0)},t.wbg.__wbg_static_accessor_GLOBAL_0be7472e492ad3e3=function(){const e=typeof global>"u"?null:global;return me(e)?0:ge(e)},t.wbg.__wbg_static_accessor_GLOBAL_THIS_1a6eb482d12c9bfb=function(){const e=typeof globalThis>"u"?null:globalThis;return me(e)?0:ge(e)},t.wbg.__wbg_static_accessor_SELF_1dc398a895c82351=function(){const e=typeof self>"u"?null:self;return me(e)?0:ge(e)},t.wbg.__wbg_static_accessor_WINDOW_ae1c80c7eea8d64a=function(){const e=typeof window>"u"?null:window;return me(e)?0:ge(e)},t.wbg.__wbg_then_0438fad860fe38e1=function(e,r){return e.then(r)},t.wbg.__wbg_then_0ffafeddf0e182a4=function(e,r,n){return e.then(r,n)},t.wbg.__wbindgen_boolean_get=function(e){const r=e;return typeof r=="boolean"?r?1:0:2},t.wbg.__wbindgen_cb_drop=function(e){const r=e.original;return r.cnt--==1?(r.a=0,!0):!1},t.wbg.__wbindgen_closure_wrapper80=function(e,r,n){return cr(e,r,21,_r)},t.wbg.__wbindgen_init_externref_table=function(){const e=N.__wbindgen_export_2,r=e.grow(4);e.set(0,void 0),e.set(r+0,void 0),e.set(r+1,null),e.set(r+2,!0),e.set(r+3,!1)},t.wbg.__wbindgen_is_function=function(e){return typeof e=="function"},t.wbg.__wbindgen_is_null=function(e){return e===null},t.wbg.__wbindgen_is_undefined=function(e){return e===void 0},t.wbg.__wbindgen_memory=function(){return N.memory},t.wbg.__wbindgen_throw=function(e,r){throw new Error(Ke(e,r))},t.wbg.__wbindgen_uint8_array_new=function(e,r){var n=lr(e,r).slice();return N.__wbindgen_free(e,r*1,1),n},t}function br(t,e){return N=t.exports,_t.__wbindgen_wasm_module=e,be=null,N.__wbindgen_start(),N}async function _t(t){if(N!==void 0)return N;typeof t<"u"&&(Object.getPrototypeOf(t)===Object.prototype?{module_or_path:t}=t:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),typeof t>"u"&&(t=new URL(""+new URL("../assets/wizard_pi_wasm_bg.CxENxoTU.wasm",import.meta.url).href,import.meta.url));const e=gr();(typeof t=="string"||typeof Request=="function"&&t instanceof Request||typeof URL=="function"&&t instanceof URL)&&(t=fetch(t));const{instance:r,module:n}=await vr(await t,e);return br(r,n)}const we=async t=>{console.log("Sending request payload to server:",t);const e={...t,session_data:Array.from(new Uint8Array(t.session_data))},r=await fetch("https://v3.spb.ru/wizard_pi_user_action",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(console.log("Server response status:",r.status),!r.ok)throw new Error("Network Error");const n=await r.json();return console.log("Server response data:",n),n},wr=async t=>{try{const e=await fetch(`https://v3.spb.ru/get_user_avatar?user_id=${t}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(console.log("Fetching avatar URL:",`https://v3.spb.ru/get_user_avatar?user_id=${t}`),console.log("Avatar fetch server response status:",e.status),!e.ok)throw new Error("Failed to fetch avatar");return(await e.json()).avatar_url||null}catch(e){return console.error("Error fetching avatar:",e),null}};var Te=(t=>(t.MINI_APP_INITIALIZED="MINI_APP_INITIALIZED",t.LOGIN_START="LOGIN_START",t.SIGN_OUT="SIGN_OUT",t))(Te||{}),oe=(t=>(t.TwoFAPassRequest="TwoFAPassRequest",t.AuthSuccess="AuthSuccess",t.AuthError="AuthError",t.SignedOut="SignedOut",t.MiniAppInitConfirmed="MiniAppInitConfirmed",t))(oe||{}),hr=I('<div class="audio-message"><audio controls>Your browser does not support the audio element.</audio> <div class="message-text"> </div></div>'),mr=I('<span class="loading-dots">🎙️  ... recording ...</span>'),yr=I('<div class="message-text"><!></div>'),pr=I('<div class="message server-message"><!></div>'),Sr=I('<div class="message user-message"><div class="message-text"> </div> <img alt="User" class="avatar"></div>'),Ar=I("<div><!></div>"),Er=I('<div class="input-container"><input type="text" placeholder="Type your message..."> <button>SEND</button></div>'),xr=I('<button class="response-button"> </button>'),Tr=I('<div class="buttons-container"></div>'),Ur=I('<button class="action-button"> </button>'),Ir=I('<div class="action-buttons-container"></div>'),kr=I('<div class="container"><div class="messages-container"></div> <!> <!> <!></div>');function Nr(t,e){Ee(e,!1);let r=q(e,"user",8),n=q(e,"avatarUrl",8),s=q(e,"buttons",12),a=q(e,"actionButtons",12),o=q(e,"canInput",12),g=q(e,"sessionData",8),d=q(e,"sessionManager",8),m=q(e,"onSignOut",8),w=q(e,"messages",12),_=[],b=O("");const v=new ArrayBuffer(0);async function u(c,f=!1){w([...w(),{type:"user",text:c}]),f&&w([...w(),{type:"server",text:`Записываю для тебя подкаст... 
Дай мне 2-3 минуты, не закрывай приложение, но можешь его свернуть, смахнув вниз`,isServiceMessage:!0},{type:"server",text:"...",isLoading:!0,isServiceMessage:!0}]);try{const E={user_id:r().id,username:r().username,user_first_name:r().first_name,user_last_name:r().last_name,action:c,session_data:g()||v,...c==="Sign out"&&{action_step:Te.SIGN_OUT}},l=await we(E);if(f&&w(w().filter(p=>p.isServiceMessage!==!0)),w([...w(),{type:"server",text:l.message,audioData:l.audio_data}]),s(l.buttons),a(l.action_buttons),o(l.can_input),l.stage===oe.SignedOut)try{await d().session_exists(BigInt(r().id))&&(await d().delete_session(BigInt(r().id)),console.log("Session successfully deleted after sign-out command from user"),m()())}catch(p){console.error("Error handling session deletion after sign-out command from user:",p)}}catch(E){console.error("Error handling message:",E),w([...w(),{type:"server",text:"Error processing your request"}])}}async function x(){i(b).trim()&&(await u(i(b)),S(b,""))}async function k(c){await u(c,c==="Get news!")}function D(c){try{const f=new Uint8Array(c),E=new Blob([f.buffer],{type:"audio/mpeg"}),l=URL.createObjectURL(E);return _.push(l),console.log("Audio URL created:",l),console.log("Audio data size:",f.length),l}catch(f){return console.error("Error creating audio URL:",f),""}}Zt(()=>{_.forEach(c=>URL.revokeObjectURL(c))}),Ae();var y=kr(),M=U(y);_e(M,5,w,ue,(c,f)=>{var E=Ar(),l=U(E);{var p=V=>{var z=pr(),B=U(z);{var K=L=>{var te=hr(),Z=U(te);Y(()=>le(Z,"src",D(i(f).audioData)));var ee=C(Z,2),ne=U(ee,!0);A(ee),A(te),Y(()=>ie(ne,i(f).text)),j("error",Z,J=>console.error("Audio error:",J)),T(L,te)},$=L=>{var te=yr(),Z=U(te);{var ee=J=>{var se=mr();T(J,se)},ne=J=>{var se=vt();Y(()=>ie(se,i(f).text)),T(J,se)};W(Z,J=>{i(f).isLoading?J(ee):J(ne,!1)})}A(te),T(L,te)};W(B,L=>{i(f).audioData?L(K):L($,!1)})}A(z),T(V,z)},H=V=>{var z=Sr(),B=U(z),K=U(B,!0);A(B);var $=C(B,2);A(z),Y(()=>{ie(K,i(f).text),le($,"src",n())}),T(V,z)};W(l,V=>{i(f).type==="server"?V(p):V(H,!1)})}A(E),Y(()=>ze(E,`message-row ${i(f).type??""}`)),T(c,E)}),A(M);var F=C(M,2);{var P=c=>{var f=Er(),E=U(f);at(E);var l=C(E,2);A(f),ct(E,()=>i(b),p=>S(b,p)),j("keydown",E,p=>p.key==="Enter"&&x()),j("click",l,x),T(c,f)};W(F,c=>{o()&&c(P)})}var R=C(F,2);{var G=c=>{var f=Tr();_e(f,5,s,ue,(E,l)=>{var p=xr(),H=U(p,!0);A(p),Y(()=>ie(H,i(l))),j("click",p,()=>k(i(l))),T(E,p)}),A(f),T(c,f)};W(R,c=>{s().length>0&&c(G)})}var Q=C(R,2);{var h=c=>{var f=Ir();_e(f,5,a,ue,(E,l)=>{var p=Ur(),H=U(p,!0);A(p),Y(()=>ie(H,i(l))),j("click",p,()=>k(i(l))),T(E,p)}),A(f),T(c,f)};W(Q,c=>{a().length>0&&c(h)})}A(y),T(t,y),xe()}var Dr=I('<img alt="User" class="avatar">'),Mr=I('<div><div><div class="message-text"> </div> <!></div></div>'),zr=I('<div class="input-container"><input> <button>Send</button></div>'),Br=I('<button class="response-button"> </button>'),Or=I('<div class="buttons-container"></div>'),Rr=I('<button class="action-button"> </button>'),Lr=I('<div class="action-buttons-container"></div>'),Cr=I('<div class="container"><div class="messages-container"></div> <!> <!> <!></div>');function Pr(t,e){Ee(e,!1);let r=q(e,"user",8),n=q(e,"avatarUrl",8),s=q(e,"sessionManager",8),a=q(e,"onAuthSuccess",8),o=O([]),g=O(""),d=O([]),m=O([]),w=O(!1);const _=new ArrayBuffer(0);let b=O();nt(async()=>{await v()});async function v(){try{const h=await we({user_id:r().id,username:r().username,user_first_name:r().first_name,user_last_name:r().last_name,action_step:Te.LOGIN_START,session_data:_});await k(h)}catch(h){console.error("Error starting authentication:",h),S(o,[...i(o),{type:"server",text:"Error occurred during login. Please restart the application and try again."}])}}async function u(){if(!i(g).trim())return;S(o,[...i(o),{type:"user",text:i(b)===oe.TwoFAPassRequest?"*".repeat(i(g).length):i(g)}]);const h=i(g);S(g,"");try{const c=await we({user_id:r().id,username:r().username,user_first_name:r().first_name,user_last_name:r().last_name,action:h,session_data:_});await k(c)}catch(c){console.error("Error handling input:",c)}}async function x(h){try{const c=await we({user_id:r().id,username:r().username,user_first_name:r().first_name,user_last_name:r().last_name,action:h,session_data:_});S(o,[...i(o),{type:"user",text:h}]),await k(c)}catch(c){console.error("Error handling button click:",c)}}async function k(h){if(S(o,[...i(o),{type:"server",text:h.message}]),S(d,h.buttons),S(m,h.action_buttons),S(w,h.can_input),S(b,h.stage),h.stage===oe.AuthSuccess&&h.session_data)try{await s().save_session(BigInt(r().id),new Uint8Array(h.session_data)),console.log("Session saved successfully in IndexedDB"),a()(h)}catch(c){console.error("Error saving session:",c)}else if(h.stage===oe.AuthError)try{await s().session_exists(BigInt(r().id))&&(await s().delete_session(BigInt(r().id)),console.log("Old session deleted due to auth error"))}catch(c){console.error("Error handling session deletion:",c)}}Ae();var D=Cr(),y=U(D);_e(y,5,()=>i(o),ue,(h,c)=>{var f=Mr(),E=U(f),l=U(E),p=U(l,!0);A(l);var H=C(l,2);{var V=z=>{var B=Dr();Y(()=>le(B,"src",n())),T(z,B)};W(H,z=>{i(c).type==="user"&&z(V)})}A(E),A(f),Y(()=>{ze(f,`message-row ${i(c).type??""}`),ze(E,`message ${i(c).type??""}-message`),ie(p,i(c).text)}),T(h,f)}),A(y);var M=C(y,2);{var F=h=>{var c=zr(),f=U(c);at(f);var E=C(f,2);A(c),Y(()=>{le(f,"type",i(b)===oe.TwoFAPassRequest?"password":"text"),le(f,"placeholder",i(b)===oe.TwoFAPassRequest?"Enter your 2FA password...":"Enter your response...")}),ct(f,()=>i(g),l=>S(g,l)),j("keydown",f,l=>l.key==="Enter"&&u()),j("click",E,u),T(h,c)};W(M,h=>{i(w)&&h(F)})}var P=C(M,2);{var R=h=>{var c=Or();_e(c,5,()=>i(d),ue,(f,E)=>{var l=Br(),p=U(l,!0);A(l),Y(()=>ie(p,i(E))),j("click",l,()=>x(i(E))),T(f,l)}),A(c),T(h,c)};W(P,h=>{i(d).length>0&&h(R)})}var G=C(P,2);{var Q=h=>{var c=Lr();_e(c,5,()=>i(m),ue,(f,E)=>{var l=Rr(),p=U(l,!0);A(l),Y(()=>ie(p,i(E))),j("click",l,()=>x(i(E))),T(f,l)}),A(c),T(h,c)};W(G,h=>{i(m).length>0&&h(Q)})}A(D),T(t,D),xe()}const Fr=`Ваши данные в безопасности!

Мы используем принцип local-first, чтобы ваши данные оставались только под вашим контролем.
Это означает, что ключевые элементы вашей Telegram-сессии хранятся непосредственно на вашем устройстве.
Пароли и одноразовые коды не сохраняются и не логируются ни в каком виде.

Мы ценим ваше доверие и предлагаем полную прозрачность. Вы всегда можете ознакомиться с исходным кодом нашего приложения в открытом репозитории, чтобы лично убедиться в безопасности и надежности нашего подхода.`;var qr=I('<div class="modal-backdrop" role="dialog" aria-modal="true"><button class="backdrop-button" aria-label="Close modal overlay"></button> <div class="modal-content" role="document"><div class="modal-header"><button class="close-button" aria-label="Close modal">×</button></div> <div class="modal-body"><p></p></div></div></div>');function Wr(t,e){Ee(e,!1);let r=q(e,"show",8),n=q(e,"onClose",8),s=O(!1);function a(){S(s,!0),setTimeout(()=>{S(s,!1),n()()},300)}function o(w){w.key==="Escape"&&a()}Ae();var g=ye(),d=ce(g);{var m=w=>{var _=qr(),b=U(_),v=C(b,2),u=U(v),x=U(u);A(u);var k=C(u,2),D=U(k);D.textContent=Fr,A(k),A(v),A(_),Y(()=>tr(v,"closing",i(s))),j("click",b,a),j("keydown",b,o),j("click",x,a),T(w,_)};W(d,w=>{r()&&w(m)})}T(t,g),xe()}async function Gr(t,e){try{if(!await t.session_exists(e))return console.log(`No session file found in IndexedDB for user: ${e}`),{success:!1};console.log(`Session file found in IndexedDB for user: ${e}`);const n=await t.get_session(e);return n?{success:!0,data:new Uint8Array(n).buffer}:(console.log(`Failed to extract session data from IndexedDB for user: ${e}`),{success:!1})}catch(r){return console.error(`Error extracting session data from IndexedDB: ${r}`),{success:!1}}}const jr={AVATARS:{TEST_USER:"https://i.ibb.co/DzMYg1f/alien-head-v2.webp",SERVER:"https://i.ibb.co/j8p2tmq/Pngtree-grey-dinosaur-cartoon-illustration-4653255.png"}},Vr=t=>t;function Yr(t){const e=t-1;return e*e*e+1}function Xe(t,{delay:e=0,duration:r=400,easing:n=Vr}={}){const s=+getComputedStyle(t).opacity;return{delay:e,duration:r,easing:n,css:a=>`opacity: ${a*s}`}}function Hr(t,{delay:e=0,duration:r=400,easing:n=Yr,start:s=0,opacity:a=0}={}){const o=getComputedStyle(t),g=+o.opacity,d=o.transform==="none"?"":o.transform,m=1-s,w=g*(1-a);return{delay:e,duration:r,easing:n,css:(_,b)=>`
			transform: ${d} scale(${1-m*b});
			opacity: ${g-w*b}
		`}}var Kr=I(`<div class="header svelte-z6hshm"><h1 class="svelte-z6hshm">This is an authentication page</h1> <p class="svelte-z6hshm">Please provide the data you will be asked for to be logged-in<br>To be sure it's safe, check "Account security policy" at the main page of the App</p></div> <div class="auth-container svelte-z6hshm"><!></div>`,1),Zr=I('<div class="header svelte-z6hshm"><h1 class="svelte-z6hshm">Welcome to <span class="viper-text svelte-z6hshm">the Viper room</span></h1> <p class="svelte-z6hshm">Your personal info wizard that keeps you always up to date</p></div> <div class="chat-container svelte-z6hshm"><!></div>',1),Jr=I('<div class="buttons-container svelte-z6hshm"><div class="main-button-container svelte-z6hshm"><button class="login-button svelte-z6hshm">START</button></div> <div class="bottom-button-container svelte-z6hshm"><button class="policy-button svelte-z6hshm">account security<br>policy</button></div></div>'),Xr=I('<p class="loading svelte-z6hshm">Loading...</p>'),Qr=I('<div class="main-container svelte-z6hshm"><!></div> <!>',1);function cn(t,e){Ee(e,!1);let r=O(null),n=O(null),s=O(!1),a=O(!1),o=jr.AVATARS.TEST_USER,g=O(),d=O(!1),m,w=O(!1),_=O([]),b=O([]),v=O([]),u=O(!0);const x=new ArrayBuffer(0);nt(async()=>{await new Promise(l=>setTimeout(l,100)),await k(),console.log("Wasm module initialized");try{console.log("App mounted. Trying to initialize user..."),await D(),S(w,!0)}catch(l){console.error("Error initializing any user:",l)}});async function k(){await _t(),S(g,new dr),await i(g).initialize(),console.log("IndexedDB session manager initialized")}const D=async()=>{var l,p,H,V;try{let z,B;(V=(H=(p=(l=window.Telegram)==null?void 0:l.WebApp)==null?void 0:p.initDataUnsafe)==null?void 0:H.user)!=null&&V.id?(z=window.Telegram.WebApp.initDataUnsafe.user,B=await wr(z.id),console.log("Telegram user initialized:",z)):(z={id:7543812650,username:"test_user",first_name:"Test",last_name:"User"},B=o,console.log("Test user initialized:",z)),S(r,z),S(n,B);const{success:K,data:$}=await Gr(i(g),BigInt(i(r).id));if(!K){console.log(`Failed to extract ${i(r).username}'s session from IndexedDB. User must be logged in first`);return}const L=await we({user_id:i(r).id,username:i(r).username,user_first_name:i(r).first_name,user_last_name:i(r).last_name,action_step:Te.MINI_APP_INITIALIZED,session_data:$||x});K&&L.stage===oe.MiniAppInitConfirmed?(console.log("Telegram client is authorized and ready for use"),S(s,!0),S(_,[{type:"server",text:L.message}]),S(b,L.buttons),S(v,L.action_buttons),S(u,L.can_input),S(n,i(n))):(console.log("Telegram client is NOT authorized"),console.log("Server response:",L.message))}catch(z){console.error("Global error in initializing user fn:",z)}},y=()=>{S(a,!0)},M=l=>{S(a,!1),S(s,!0),S(_,[{type:"server",text:l.message}]),S(b,l.buttons),S(v,l.action_buttons),S(u,l.can_input)},F=()=>{S(s,!1)},P=()=>{S(d,!0)},R=()=>{S(d,!1)};Ae();var G=Qr(),Q=ce(G),h=U(Q);{var c=l=>{var p=ye(),H=ce(p);{var V=B=>{var K=Kr(),$=C(ce(K),2),L=U($);Pr(L,{get user(){return i(r)},get avatarUrl(){return i(n)},get sessionManager(){return i(g)},onAuthSuccess:M}),A($),T(B,K)},z=B=>{var K=ye(),$=ce(K);{var L=Z=>{var ee=Zr(),ne=C(ce(ee),2),J=U(ne);Nr(J,{get user(){return i(r)},get avatarUrl(){return i(n)},get messages(){return i(_)},get buttons(){return i(b)},get actionButtons(){return i(v)},get canInput(){return i(u)},sessionData:m,get sessionManager(){return i(g)},onSignOut:F}),A(ne),T(Z,ee)},te=Z=>{var ee=ye(),ne=ce(ee);{var J=se=>{var he=Jr(),Ue=U(he),Oe=U(Ue);A(Ue);var Re=C(Ue,2),Le=U(Re);A(Re),A(he),j("click",Oe,y),Ne(1,Oe,()=>Hr,()=>({duration:500,delay:600,start:.95,opacity:0})),j("click",Le,P),Ne(1,Le,()=>Xe,()=>({duration:300,delay:300})),Ne(1,he,()=>Xe,()=>({duration:300,delay:150})),T(se,he)};W(ne,se=>{i(w)&&se(J)})}T(Z,ee)};W($,Z=>{i(s)?Z(L):Z(te,!1)},!0)}T(B,K)};W(H,B=>{i(a)?B(V):B(z,!1)})}T(l,p)},f=l=>{var p=Xr();T(l,p)};W(h,l=>{i(r)?l(c):l(f,!1)})}A(Q);var E=C(Q,2);Wr(E,{get show(){return i(d)},onClose:R}),T(t,G),xe()}export{cn as component,on as universal};
